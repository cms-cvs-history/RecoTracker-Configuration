
#
# Tracker Tracking
#
  
# general CPEs 
  include "RecoLocalTracker/SiPixelRecHits/data/PixelCPEESProducers.cff" 

# TTRHBuilders
  include "RecoTracker/TransientTrackingRecHit/data/TTRHBuilders.cff"

# Seeds 
  include "RecoTracker/TkSeedGenerator/data/GlobalMixedSeeds.cff"
  include "RecoTracker/TkSeedGenerator/data/GlobalPixelSeeds.cff"                           

# Ckf
  include "RecoTracker/CkfPattern/data/CkfTrackCandidates.cff"

# Final Fit
  include "RecoTracker/TrackProducer/data/CTFFinalFitWithMaterial.cff"

# RoadSearchSeedFinder
include "RecoTracker/RoadSearchSeedFinder/data/RoadSearchSeeds.cff"

# RoadSearchCloudMaker
include "RecoTracker/RoadSearchCloudMaker/data/RoadSearchClouds.cff"

# RoadSearchTrackCandidateMaker
include "RecoTracker/RoadSearchTrackCandidateMaker/data/RoadSearchTrackCandidates.cff"

# RS track fit with material 
include "RecoTracker/TrackProducer/data/RSFinalFitWithMaterial.cff"

# Iterative Tracking
include "RecoTracker/IterativeTracking/data/iterativeTk.cff"

############ new tracking configuration ################
### it is placed here as a temporary solution


### Seeding 
  include "RecoTracker/TkSeedGenerator/data/GlobalCombinedSeeds.cff"
  include "RecoTracker/TkSeedGenerator/data/GlobalSeedsFromPairsWithVertices.cff"
  include "RecoTracker/TkSeedGenerator/data/GlobalSeedsFromTripletsWithVertices.cff"

  module newSeedFromPairs = globalSeedsFromPairsWithVertices from "RecoTracker/TkSeedGenerator/data/GlobalSeedsFromPairsWithVertices.cfi"
  replace newSeedFromPairs.RegionFactoryPSet.RegionPSet.ptMin = 0.9

  module newSeedFromTriplets = globalSeedsFromTripletsWithVertices from "RecoTracker/TkSeedGenerator/data/GlobalSeedsFromTripletsWithVertices.cfi"
  replace newSeedFromTriplets.RegionFactoryPSet.RegionPSet.ptMin = 0.5

  module newCombinedSeeds = globalCombinedSeeds from "RecoTracker/TkSeedGenerator/data/GlobalCombinedSeeds.cfi"
  replace newCombinedSeeds.PairCollection = "newSeedFromPairs"
  replace newCombinedSeeds.TripletCollection = "newSeedFromTriplets"

### Building
  es_module newTrajectoryFilter = trajectoryFilterESProducer from "TrackingTools/TrajectoryFiltering/data/TrajectoryFilterESProducer.cfi"
  replace newTrajectoryFilter.ComponentName = "newTrajectoryFilter"
  replace newTrajectoryFilter.filterPset.minimumNumberOfHits = 3 
  replace newTrajectoryFilter.filterPset.minPt = 0.3

  es_module newTrajectoryBuilder = GroupedCkfTrajectoryBuilder from "RecoTracker/CkfPattern/data/GroupedCkfTrajectoryBuilderESProducer.cfi"
  replace newTrajectoryBuilder.ComponentName = "newTrajectoryBuilder"
  replace newTrajectoryBuilder.trajectoryFilterName =  "newTrajectoryFilter"

  module newTrackCandidateMaker = ckfTrackCandidates from "RecoTracker/CkfPattern/data/CkfTrackCandidates.cfi"
  replace newTrackCandidateMaker.SeedProducer = "newCombinedSeeds"
  replace newTrackCandidateMaker.TrajectoryBuilder = "newTrajectoryBuilder"
  replace newTrackCandidateMaker.useHitsSplitting = true
  replace newTrackCandidateMaker.doSeedingRegionRebuilding = true

### Final Fitting
  es_module FittingSmootherWithOutlierRejection = RKFittingSmoother from "TrackingTools/TrackFitters/data/RungeKuttaKFFittingSmootherESProducer.cfi"
  replace FittingSmootherWithOutlierRejection.ComponentName = "FittingSmootherWithOutlierRejection"	
  replace FittingSmootherWithOutlierRejection.EstimateCut = 20
  replace FittingSmootherWithOutlierRejection.MinNumberOfHits = 3

  module  preFilterFirstStepTracks = ctfWithMaterialTracks from "RecoTracker/TrackProducer/data/CTFFinalFitWithMaterial.cfi"
  replace preFilterFirstStepTracks.src = "newTrackCandidateMaker"
  replace preFilterFirstStepTracks.TTRHBuilder =  "WithAngleAndTemplate"
  replace preFilterFirstStepTracks.Fitter = "FittingSmootherWithOutlierRejection"
  replace preFilterFirstStepTracks.AlgorithmName =  "ctf"

### Collection cleaning and quality
  include "RecoTracker/FinalTrackSelectors/data/TracksWithQuality.cff"
  // defines sequence tracksWithQuality, input is preFilterFirstStepTracks, output is firstStepTracksWithQuality

#######################################################################################
# include track colleciton merging sequence
  include "RecoTracker/FinalTrackSelectors/data/MergeTrackCollections.cff"
#######################################################################################

#sequence ckftracks = {globalMixedSeeds,globalPixelSeeds, ckfTrackCandidates,ctfWithMaterialTracks} #only old ctf sequence
sequence newTracking = {newSeedFromPairs,newSeedFromTriplets,newCombinedSeeds,
                        newTrackCandidateMaker,
                        preFilterFirstStepTracks,
                        tracksWithQuality}

sequence ckftracks = {newTracking, iterTracking, trackCollectionMerging}              

sequence rstracks  = {roadSearchSeeds, roadSearchClouds, rsTrackCandidates, rsWithMaterialTracks}
